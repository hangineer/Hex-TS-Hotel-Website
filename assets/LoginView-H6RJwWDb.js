import{d as S,s as I,v as d,x as V,r as M,o as C,c as D,b as e,y as w,z as n,A as c,B as q,a as A,w as B,f as E,C as m,D as b,p as T,e as U,_ as H}from"./index-r6B0-3M7.js";import{_ as O}from"./Line-Ru759zyg.js";import{c as _,a as h}from"./validate-oAscdx-l.js";import{M as j}from"./bootstrap.esm-wsTTog6B.js";const t=u=>(T("data-v-703d670a"),u=u(),U(),u),z={class:"container-fluid d-flex align-items-center bg-neutral-bg text-white position-relative"},L=t(()=>e("img",{src:O,alt:"Line",class:"position-absolute end-0 top-0 mt-8 py-5"},null,-1)),N=t(()=>e("img",{src:"https://images.unsplash.com/photo-1630587148265-761cbd139043?q=80&w=1887&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D",alt:"loginImg",class:"w-50 object-fit-cover position-relative z-1 d-none d-lg-block",style:{"max-height":"1078px"}},null,-1)),R={class:"row w-lg-50 flex-grow-1 position-relative z-1"},G={class:"col-lg-6 col mx-auto"},W=t(()=>e("p",{class:"mb-2 text-primary fw-bold fs-small fs-lg-0"},"享樂酒店，誠摯歡迎",-1)),Y=t(()=>e("h1",{class:"fw-bold fs-lg-1 fs-3 mb-7"},"立即開始旅程",-1)),$={class:"mb-3"},F=t(()=>e("label",{for:"email",class:"form-label"},"電子信箱",-1)),J={class:"mb-3"},K=t(()=>e("label",{for:"password",class:"form-label"},"密碼",-1)),Q={class:"mb-7 d-flex justify-content-between"},X={class:"form-check"},Z=t(()=>e("label",{class:"form-check-label",for:"remember"}," 記住帳號 ",-1)),ee=t(()=>e("input",{type:"submit",class:"btn btn-primary w-100 py-3 px-6",value:"會員登入"},null,-1)),oe=t(()=>e("span",null,"沒有會員嗎？",-1)),se={class:"modal-dialog modal-dialog-centered"},te={class:"modal-content"},ae=t(()=>e("div",{class:"modal-header"},[e("h5",{class:"modal-title text-black"},"忘記密碼"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),le={class:"mb-3"},ie=t(()=>e("label",{for:"myEmail",class:"form-label"},"電子信箱",-1)),re={class:"mb-3"},ne=t(()=>e("label",{for:"newPassword",class:"form-label"},"新密碼",-1)),de=t(()=>e("label",{for:"code",class:"form-label"},"驗證碼",-1)),ce=t(()=>e("div",{class:"modal-footer"},[e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"取消"),e("button",{type:"submit",class:"btn btn-primary"},"確認")],-1)),me=S({__name:"LoginView",setup(u){const g=I(),p=d(!1),i=d({email:"",password:""});V(async()=>{localStorage.getItem("email")&&(i.value.email=localStorage.getItem("email")||"",p.value=!0),f.value=new j(v.value)});async function x(){if(!P(i.value))return;const s=await b("/api/v1/user/login","POST",i.value);if(!s.status){m.fire({icon:"error",title:s.message});return}p.value?localStorage.setItem("email",i.value.email):localStorage.removeItem("email"),localStorage.setItem("token",s.token),g.push("/user")}const v=d(),f=d(),r=d({email:"",newPassword:"",code:""});async function y(){const{value:s}=await m.fire({title:"請輸入註冊的電子信箱",input:"text",inputValidator:a=>{if(!/^\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/.test(a))return"電子信箱格式錯誤"}});if(!s)return;(await b("/api/v1/verify/email","POST",{email:s})).result.isEmailExists||m.fire({icon:"error",title:"該信箱未註冊"}),await b("/api/v1/verify/generateEmailCode","POST",{email:s});const l=await m.fire({title:"已發送驗證碼至信箱"});(l.isConfirmed||l.isDismissed)&&f.value&&f.value.show()}async function k(){const{email:s,newPassword:o}=r.value;if(!(_(s)&&h(o,o)))return;const l=await b("/api/v1/user/forgot","POST",r.value);console.log(l),m.fire({icon:l.status?"success":"error",title:l.status?"變更密碼成功":l.message}),l.status&&f.value.hide()}function P(s){return _(s.email)&&h(s.password,s.password)}return(s,o)=>{const l=M("router-link");return C(),D("main",z,[L,N,e("div",R,[e("div",G,[e("div",null,[W,Y,e("form",{class:"needs-validation mb-7",onSubmit:w(x,["prevent"])},[e("div",$,[F,n(e("input",{type:"email",class:"form-control",id:"email","aria-describedby":"emailHelp",placeholder:"hello@exsample.com",required:"","onUpdate:modelValue":o[0]||(o[0]=a=>i.value.email=a)},null,512),[[c,i.value.email]])]),e("div",J,[K,n(e("input",{type:"password",class:"form-control",id:"password","aria-describedby":"password",autocomplete:"on",placeholder:"請輸入密碼",required:"","onUpdate:modelValue":o[1]||(o[1]=a=>i.value.password=a)},null,512),[[c,i.value.password]])]),e("div",Q,[e("div",X,[n(e("input",{class:"form-check-input",type:"checkbox",id:"remember","onUpdate:modelValue":o[2]||(o[2]=a=>p.value=a)},null,512),[[q,p.value]]),Z]),e("span",{class:"text-decoration-underline text-primary pointer",onClick:y},"忘記密碼？")]),ee],32),oe,A(l,{to:"/signIn"},{default:B(()=>[E("前往註冊")]),_:1})])])]),e("div",{class:"modal fade",tabindex:"-1",ref_key:"modalPwd",ref:v,"data-bs-backdrop":"static"},[e("div",se,[e("div",te,[ae,e("form",{class:"modal-body text-black",onSubmit:w(k,["prevent"])},[e("div",le,[ie,n(e("input",{type:"email",class:"form-control",id:"myEmail",placeholder:"hello@exsample.com",required:"","onUpdate:modelValue":o[3]||(o[3]=a=>r.value.email=a)},null,512),[[c,r.value.email]])]),e("div",re,[ne,n(e("input",{type:"password",class:"form-control",id:"newPassword",autocomplete:"on",placeholder:"請輸入新密碼",required:"","onUpdate:modelValue":o[4]||(o[4]=a=>r.value.newPassword=a)},null,512),[[c,r.value.newPassword]])]),e("div",null,[de,n(e("input",{type:"text",class:"form-control",id:"code",autocomplete:"on",placeholder:"請輸入驗證碼",required:"","onUpdate:modelValue":o[5]||(o[5]=a=>r.value.code=a)},null,512),[[c,r.value.code]])]),ce],32)])])],512)])}}}),we=H(me,[["__scopeId","data-v-703d670a"]]);export{we as default};
