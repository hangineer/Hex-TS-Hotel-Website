import{d as V,s as F,K as R,x as u,o as l,c as n,b as e,t as p,F as h,g as y,z as T,A as m,B as g,J as O,E as A,D as Z,p as q,e as G,_ as H,y as J,G as S,H as K,I as k,u as I,n as B,q as M}from"./index-8F6aToGJ.js";import{a as j}from"./validate-zons99io.js";import{C as D}from"./cityCountyData-3AYHRziG.js";const P=w=>(q("data-v-f5f38a71"),w=w(),G(),w),Q=P(()=>e("h2",{class:"title"},"修改密碼",-1)),W=P(()=>e("p",{class:"mb-2 text-neutral-80 fw-medium"},"電子信箱",-1)),X={class:"mb-3 mb-lg-5 fw-bold"},ee={key:0,class:"d-flex align-items-center gap-3"},se={class:"flex-grow-1"},te=P(()=>e("p",{class:"mb-2 text-neutral-80 fw-medium"},"密碼",-1)),ae={class:"mb-3 mb-lg-5"},le=P(()=>e("label",{for:"password",class:"form-label fw-bold"},"舊密碼",-1)),oe={class:"mb-3 mb-lg-5"},de=P(()=>e("label",{for:"newPassword",class:"form-label fw-bold"},"新密碼",-1)),ne={class:"mb-5 mb-lg-7"},re=P(()=>e("label",{for:"checkPwd",class:"form-label fw-bold"},"確認新密碼",-1)),ue=V({__name:"EditPwd",setup(w){const v=F(),{user:i}=R(v),t=u(!1),o=u({userId:i.value._id,email:i.value.email,oldPassword:"",newPassword:""}),f=u("");async function $(){if(!j(o.value.newPassword,f.value))return;const _=await A("/api/v1/user/","PUT",o.value);Z.fire({icon:_.status?"success":"error",title:_.status?"修改密碼成功":_.message}),_.status&&(t.value=!1,o.value.newPassword=o.value.oldPassword=f.value="")}return(_,c)=>(l(),n("div",null,[Q,W,e("p",X,p(o.value.email),1),t.value?(l(),n("form",{key:1,onSubmit:T($,["prevent"])},[e("div",ae,[le,m(e("input",{type:"password",class:"form-control p-3 rounded-3",id:"password",placeholder:"請輸入舊密碼","onUpdate:modelValue":c[1]||(c[1]=r=>o.value.oldPassword=r),autocomplete:"off"},null,512),[[g,o.value.oldPassword]])]),e("div",oe,[de,m(e("input",{type:"password",class:"form-control p-3 rounded-3",id:"newPassword",placeholder:"請輸入新密碼","onUpdate:modelValue":c[2]||(c[2]=r=>o.value.newPassword=r),autocomplete:"off"},null,512),[[g,o.value.newPassword]])]),e("div",ne,[re,m(e("input",{type:"password",class:"form-control p-3 rounded-3",id:"checkPwd",placeholder:"請再輸入一次新密碼","onUpdate:modelValue":c[3]||(c[3]=r=>f.value=r),autocomplete:"off"},null,512),[[g,f.value]])]),e("input",{type:"submit",class:O(["btn btn-primary py-3 px-6 rounded-3 w-100 w-lg-auto",{disabled:!o.value.oldPassword||!o.value.oldPassword||!f.value}]),value:"儲存設定"},null,2)],32)):(l(),n("div",ee,[e("div",se,[te,(l(),n(h,null,y(10,r=>e("i",{class:"pwdPoint d-inline-block bg-black rounded-circle me-2",key:r})),64))]),e("span",{class:"text-primary pointer text-decoration-underline",onClick:c[0]||(c[0]=r=>t.value=!0)},"重設")]))]))}}),ie=H(ue,[["__scopeId","data-v-f5f38a71"]]),ce=e("h2",{class:"title"},"基本資料",-1),pe={key:0},me=e("p",{class:"mb-2 text-neutral-80 fw-medium"},"姓名",-1),ve={class:"mb-3 mb-lg-5 fw-bold"},fe=e("p",{class:"mb-2 text-neutral-80 fw-medium"},"手機號碼",-1),_e={class:"mb-3 mb-lg-5 fw-bold"},be=e("p",{class:"mb-2 text-neutral-80 fw-medium"},"生日",-1),we={class:"mb-3 mb-lg-5 fw-bold"},he=e("p",{class:"mb-2 text-neutral-80 fw-medium"},"地址",-1),ye={class:"mb-5 mb-lg-7 fw-bold"},ge={class:"mb-5"},Pe=e("label",{for:"userName",class:"form-label fw-bold"},"姓名",-1),$e={class:"mb-5"},xe=e("label",{for:"userName",class:"form-label fw-bold"},"手機號碼",-1),Ne={class:"mb-5"},ke=e("label",{for:"birth",class:"form-label fw-bold"},"生日",-1),Ce={class:"d-flex gap-2"},Ue=["value"],Se=["value"],De=["value"],Ie={class:"mb-5 mb-lg-7"},Ve=e("label",{for:"address",class:"form-label fw-bold"},"地址",-1),Ae={class:"d-flex gap-2 mb-3"},Le=["value"],ze=["value"],Ee=e("input",{type:"submit",class:"btn btn-primary py-3 px-6 rounded-3 w-100 w-lg-auto",value:"儲存設定"},null,-1),Be=V({__name:"UserInfo",setup(w){const v=u(!1),i=JSON.parse(localStorage.getItem("user")),t=u({userId:i._id,name:i.name,phone:i.phone,birthday:new Date(i.birthday).toLocaleDateString(),address:{zipcode:i.address.zipcode,detail:i.address.detail}}),o=u("");async function f(){t.value.birthday=`${r.value}/${b.value}/${C.value}`;const d=await A("/api/v1/user/","PUT",t.value);if(Z.fire({icon:d.status?"success":"error",title:d.status?"個資修改成功":d.message}),d.status){localStorage.setItem("user",JSON.stringify(d.result)),v.value=!1;const{address:a,birthday:N,name:s,phone:Y}=d.result;t.value.name=s,t.value.phone=Y,t.value.address=a,t.value.birthday=new Date(N).toLocaleDateString(),_()}}const $=u({CityName:"",CityEngName:"",AreaList:[]});J(()=>{D.forEach(d=>{d.AreaList.find(N=>Number(N.ZipCode)===i.address.zipcode)&&(x.value=d.CityName,$.value=d)}),E(),_()});function _(){const d=t.value.address;o.value=$.value.CityName+$.value.AreaList.find(a=>Number(a.ZipCode)===d.zipcode).AreaName+d.detail}const c=t.value.birthday.split("/"),r=u(Number(c[0])),b=u(Number(c[1])),C=u(Number(c[2])),U=u(31),L=()=>{b.value===2?U.value=r.value%4?28:29:[1,3,5,7,8,10,12].includes(b.value)?U.value=31:U.value=30};S(()=>r.value,L),S(()=>b.value,L);const z=u([]),x=u(""),E=()=>{const d=D.find(a=>a.CityName===x.value);z.value=d.AreaList};return S(()=>x.value,()=>E()),(d,a)=>{const N=K("tel");return l(),n("div",null,[ce,v.value?(l(),n("form",{key:1,onSubmit:T(f,["prevent"])},[e("div",ge,[Pe,m(e("input",{type:"text",class:"form-control p-3 rounded-3",id:"userName",placeholder:"請輸入姓名","onUpdate:modelValue":a[1]||(a[1]=s=>t.value.name=s)},null,512),[[g,t.value.name]])]),e("div",$e,[xe,m(e("input",{type:"tel",class:"form-control p-3 rounded-3",id:"userName",placeholder:"請輸入手機號碼","onUpdate:modelValue":a[2]||(a[2]=s=>t.value.phone=s)},null,512),[[g,t.value.phone],[N]])]),e("div",Ne,[ke,e("div",Ce,[m(e("select",{id:"birth",class:"form-select p-3 rounded-3","onUpdate:modelValue":a[3]||(a[3]=s=>r.value=s)},[(l(),n(h,null,y(100,s=>e("option",{key:s,value:new Date().getFullYear()-(100-s)},p(new Date().getFullYear()-(100-s))+" 年 ",9,Ue)),64))],512),[[k,r.value]]),m(e("select",{class:"form-select p-3 rounded-3","onUpdate:modelValue":a[4]||(a[4]=s=>b.value=s)},[(l(),n(h,null,y(12,s=>e("option",{key:s,value:s},p(s)+" 月",9,Se)),64))],512),[[k,b.value]]),m(e("select",{class:"form-select p-3 rounded-3","onUpdate:modelValue":a[5]||(a[5]=s=>C.value=s)},[(l(!0),n(h,null,y(U.value,s=>(l(),n("option",{key:s,value:s},p(s)+" 日",9,De))),128))],512),[[k,C.value]])])]),e("div",Ie,[Ve,e("div",Ae,[m(e("select",{id:"address",class:"form-select p-3 rounded-3","onUpdate:modelValue":a[6]||(a[6]=s=>x.value=s)},[(l(!0),n(h,null,y(I(D),s=>(l(),n("option",{key:s.CityName,value:s.CityName},p(s.CityName),9,Le))),128))],512),[[k,x.value]]),m(e("select",{class:"form-select p-3 rounded-3","onUpdate:modelValue":a[7]||(a[7]=s=>t.value.address.zipcode=s)},[(l(!0),n(h,null,y(z.value,s=>(l(),n("option",{key:s.ZipCode,value:s.ZipCode},p(s.AreaName),9,ze))),128))],512),[[k,t.value.address.zipcode]])]),m(e("input",{type:"text",class:"form-control p-3 rounded-3",placeholder:"請輸入詳細地址","onUpdate:modelValue":a[8]||(a[8]=s=>t.value.address.detail=s)},null,512),[[g,t.value.address.detail]])]),Ee],32)):(l(),n("div",pe,[me,e("p",ve,p(t.value.name),1),fe,e("p",_e,p(t.value.phone),1),be,e("p",we,p(r.value)+" 年 "+p(b.value)+" 月 "+p(C.value)+" 日",1),he,e("p",ye,p(o.value),1),e("input",{type:"button",class:"btn btn-outline-primary py-3 px-6 fw-bold",value:"編輯",onClick:a[0]||(a[0]=s=>v.value=!0)})]))])}}}),Me={class:"bg-neutral-bg"},Fe={class:"row g-5 g-lg-7"},Re={class:"col-12 col-lg-5"},Te={class:"bg-white p-5 p-lg-7 rounded-6"},Ze={class:"col-12 col-lg-7"},Je={class:"bg-white p-5 p-lg-7 rounded-6"},Ge=V({__name:"UserView",setup(w){const v=F(),{setUserInfo:i}=v,{user:t}=R(v);return J(async()=>{const o=await A("/api/v1/user");i(o.result)}),(o,f)=>(l(),n("main",Me,[e("div",Fe,[e("div",Re,[e("section",Te,[I(t)._id?(l(),B(ie,{key:0})):M("",!0)])]),e("div",Ze,[e("section",Je,[I(t)._id?(l(),B(Be,{key:0})):M("",!0)])])])]))}});export{Ge as default};
