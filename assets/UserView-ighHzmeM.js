import{d as U,v as r,o as l,c as d,b as e,t as i,F as h,g as y,y as M,z as m,A as g,I as Z,D as I,C as B,p as R,e as T,_ as Y,x as F,E as z,G as q,H as $,u as G,n as L,q as E}from"./index-n5jyQC_x.js";import{a as H}from"./validate-dZ519tGW.js";import{C as D}from"./cityCountyData-3AYHRziG.js";const N=b=>(R("data-v-e326c686"),b=b(),T(),b),j=N(()=>e("h2",{class:"title"},"修改密碼",-1)),K=N(()=>e("p",{class:"mb-2 text-neutral-80 fw-medium"},"電子信箱",-1)),Q={class:"mb-3 mb-lg-5 fw-bold"},W={key:0,class:"d-flex align-items-center gap-3"},X={class:"flex-grow-1"},ee=N(()=>e("p",{class:"mb-2 text-neutral-80 fw-medium"},"密碼",-1)),se={class:"mb-3 mb-lg-5"},te=N(()=>e("label",{for:"password",class:"form-label fw-bold"},"舊密碼",-1)),ae={class:"mb-3 mb-lg-5"},le=N(()=>e("label",{for:"newPassword",class:"form-label fw-bold"},"新密碼",-1)),oe={class:"mb-5 mb-lg-7"},de=N(()=>e("label",{for:"checkPwd",class:"form-label fw-bold"},"確認新密碼",-1)),ne=U({__name:"EditPwd",setup(b){const c=r(!1),n=JSON.parse(localStorage.getItem("user")),t=r({userId:n._id,email:n.email,oldPassword:"",newPassword:""}),_=r("");async function S(){if(!H(t.value.newPassword,_.value))return;const v=await I("/api/v1/user/","PUT",t.value);B.fire({icon:v.status?"success":"error",title:v.status?"修改密碼成功":v.message}),v.status&&(c.value=!1,t.value.newPassword=t.value.oldPassword=_.value="")}return(v,p)=>(l(),d("div",null,[j,K,e("p",Q,i(t.value.email),1),c.value?(l(),d("form",{key:1,onSubmit:M(S,["prevent"])},[e("div",se,[te,m(e("input",{type:"password",class:"form-control p-3 rounded-3",id:"password",placeholder:"請輸入舊密碼","onUpdate:modelValue":p[1]||(p[1]=u=>t.value.oldPassword=u),autocomplete:"off"},null,512),[[g,t.value.oldPassword]])]),e("div",ae,[le,m(e("input",{type:"password",class:"form-control p-3 rounded-3",id:"newPassword",placeholder:"請輸入新密碼","onUpdate:modelValue":p[2]||(p[2]=u=>t.value.newPassword=u),autocomplete:"off"},null,512),[[g,t.value.newPassword]])]),e("div",oe,[de,m(e("input",{type:"password",class:"form-control p-3 rounded-3",id:"checkPwd",placeholder:"請再輸入一次新密碼","onUpdate:modelValue":p[3]||(p[3]=u=>_.value=u),autocomplete:"off"},null,512),[[g,_.value]])]),e("input",{type:"submit",class:Z(["btn btn-primary py-3 px-6 rounded-3 w-100 w-lg-auto",{disabled:!t.value.oldPassword||!t.value.oldPassword||!_.value}]),value:"儲存設定"},null,2)],32)):(l(),d("div",W,[e("div",X,[ee,(l(),d(h,null,y(10,u=>e("i",{class:"pwdPoint d-inline-block bg-black rounded-circle me-2",key:u})),64))]),e("span",{class:"text-primary pointer text-decoration-underline",onClick:p[0]||(p[0]=u=>c.value=!0)},"重設")]))]))}}),re=Y(ne,[["__scopeId","data-v-e326c686"]]),ue=e("h2",{class:"title"},"基本資料",-1),ie={key:0},ce=e("p",{class:"mb-2 text-neutral-80 fw-medium"},"姓名",-1),pe={class:"mb-3 mb-lg-5 fw-bold"},me=e("p",{class:"mb-2 text-neutral-80 fw-medium"},"手機號碼",-1),ve={class:"mb-3 mb-lg-5 fw-bold"},_e=e("p",{class:"mb-2 text-neutral-80 fw-medium"},"生日",-1),fe={class:"mb-3 mb-lg-5 fw-bold"},be=e("p",{class:"mb-2 text-neutral-80 fw-medium"},"地址",-1),we={class:"mb-5 mb-lg-7 fw-bold"},he={class:"mb-5"},ye=e("label",{for:"userName",class:"form-label fw-bold"},"姓名",-1),ge={class:"mb-5"},Ne=e("label",{for:"userName",class:"form-label fw-bold"},"手機號碼",-1),Pe={class:"mb-5"},$e=e("label",{for:"birth",class:"form-label fw-bold"},"生日",-1),xe={class:"d-flex gap-2"},Ce=["value"],ke=["value"],Se=["value"],De={class:"mb-5 mb-lg-7"},Ue=e("label",{for:"address",class:"form-label fw-bold"},"地址",-1),Ie={class:"d-flex gap-2 mb-3"},Ae=["value"],Ve=["value"],ze=e("input",{type:"submit",class:"btn btn-primary py-3 px-6 rounded-3 w-100 w-lg-auto",value:"儲存設定"},null,-1),Le=U({__name:"UserInfo",setup(b){const c=r(!1),n=JSON.parse(localStorage.getItem("user")),t=r({userId:n._id,name:n.name,phone:n.phone,birthday:new Date(n.birthday).toLocaleDateString(),address:{zipcode:n.address.zipcode,detail:n.address.detail}}),_=r("");async function S(){t.value.birthday=`${w.value}/${f.value}/${x.value}`;const o=await I("/api/v1/user/","PUT",t.value);if(B.fire({icon:o.status?"success":"error",title:o.status?"個資修改成功":o.message}),o.status){localStorage.setItem("user",JSON.stringify(o.result)),c.value=!1;const{address:a,birthday:P,name:s,phone:O}=o.result;t.value.name=s,t.value.phone=O,t.value.address=a,t.value.birthday=new Date(P).toLocaleDateString(),p()}}const v=r({CityName:"",CityEngName:"",AreaList:[]});F(()=>{D.forEach(o=>{o.AreaList.find(P=>Number(P.ZipCode)===n.address.zipcode)&&(k.value=o.CityName,v.value=o)}),J(),p()});function p(){const o=t.value.address;_.value=v.value.CityName+v.value.AreaList.find(a=>Number(a.ZipCode)===o.zipcode).AreaName+o.detail}const u=t.value.birthday.split("/"),w=r(Number(u[0])),f=r(Number(u[1])),x=r(Number(u[2])),C=r(31),A=()=>{f.value===2?C.value=w.value%4?28:29:[1,3,5,7,8,10,12].includes(f.value)?C.value=31:C.value=30};z(()=>w.value,A),z(()=>f.value,A);const V=r([]),k=r(""),J=()=>{const o=D.find(a=>a.CityName===k.value);V.value=o.AreaList};return(o,a)=>{const P=q("tel");return l(),d("div",null,[ue,c.value?(l(),d("form",{key:1,onSubmit:M(S,["prevent"])},[e("div",he,[ye,m(e("input",{type:"text",class:"form-control p-3 rounded-3",id:"userName",placeholder:"請輸入姓名","onUpdate:modelValue":a[1]||(a[1]=s=>t.value.name=s)},null,512),[[g,t.value.name]])]),e("div",ge,[Ne,m(e("input",{type:"tel",class:"form-control p-3 rounded-3",id:"userName",placeholder:"請輸入手機號碼","onUpdate:modelValue":a[2]||(a[2]=s=>t.value.phone=s)},null,512),[[g,t.value.phone],[P]])]),e("div",Pe,[$e,e("div",xe,[m(e("select",{id:"birth",class:"form-select p-3 rounded-3","onUpdate:modelValue":a[3]||(a[3]=s=>w.value=s)},[(l(),d(h,null,y(100,s=>e("option",{key:s,value:new Date().getFullYear()-(100-s)},i(new Date().getFullYear()-(100-s))+" 年 ",9,Ce)),64))],512),[[$,w.value]]),m(e("select",{class:"form-select p-3 rounded-3","onUpdate:modelValue":a[4]||(a[4]=s=>f.value=s)},[(l(),d(h,null,y(12,s=>e("option",{key:s,value:s},i(s)+" 月",9,ke)),64))],512),[[$,f.value]]),m(e("select",{class:"form-select p-3 rounded-3","onUpdate:modelValue":a[5]||(a[5]=s=>x.value=s)},[(l(!0),d(h,null,y(C.value,s=>(l(),d("option",{key:s,value:s},i(s)+" 日",9,Se))),128))],512),[[$,x.value]])])]),e("div",De,[Ue,e("div",Ie,[m(e("select",{id:"address",class:"form-select p-3 rounded-3","onUpdate:modelValue":a[6]||(a[6]=s=>k.value=s)},[(l(!0),d(h,null,y(G(D),s=>(l(),d("option",{key:s.CityName,value:s.CityName},i(s.CityName),9,Ae))),128))],512),[[$,k.value]]),m(e("select",{class:"form-select p-3 rounded-3","onUpdate:modelValue":a[7]||(a[7]=s=>t.value.address.zipcode=s)},[(l(!0),d(h,null,y(V.value,s=>(l(),d("option",{key:s.ZipCode,value:s.ZipCode},i(s.AreaName),9,Ve))),128))],512),[[$,t.value.address.zipcode]])]),m(e("input",{type:"text",class:"form-control p-3 rounded-3",placeholder:"請輸入詳細地址","onUpdate:modelValue":a[8]||(a[8]=s=>t.value.address.detail=s)},null,512),[[g,t.value.address.detail]])]),ze],32)):(l(),d("div",ie,[ce,e("p",pe,i(t.value.name),1),me,e("p",ve,i(t.value.phone),1),_e,e("p",fe,i(w.value)+" 年 "+i(f.value)+" 月 "+i(x.value)+" 日",1),be,e("p",we,i(_.value),1),e("input",{type:"button",class:"btn btn-outline-primary py-3 px-6 fw-bold",value:"編輯",onClick:a[0]||(a[0]=s=>c.value=!0)})]))])}}}),Ee={class:"bg-neutral-bg"},Me={class:"row g-5 g-lg-7"},Be={class:"col-12 col-lg-5"},Fe={class:"bg-white p-5 p-lg-7 rounded-6"},Je={class:"col-12 col-lg-7"},Oe={class:"bg-white p-5 p-lg-7 rounded-6"},Ye=U({__name:"UserView",setup(b){const c=r({_id:"",updatedAt:"",phone:"",name:"",email:"",createdAt:"",birthday:"",address:{detail:"",zipcode:0}});return F(async()=>{const n=await I("/api/v1/user");localStorage.setItem("user",JSON.stringify(n.result)),c.value=n.result}),(n,t)=>(l(),d("main",Ee,[e("div",Me,[e("div",Be,[e("section",Fe,[c.value._id?(l(),L(re,{key:0})):E("",!0)])]),e("div",Je,[e("section",Oe,[c.value._id?(l(),L(Le,{key:0})):E("",!0)])])])]))}});export{Ye as default};
